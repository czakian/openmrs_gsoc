<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
	"http://www.ibatis.com/dtd/sql-map-2.dtd">
 
<sqlMap namespace="org.openmrs.ComplexObs">

<!-- ************************************************************ -->
<!-- ** Creation                                               ** -->
<!-- ************************************************************ -->

<insert id="createComplexObs" parameterClass="org.openmrs.ComplexObs">
	INSERT INTO complex_obs
		(
		obs_id,
		mime_type_id,
		urn,
		complex_value
		)
	VALUES
		(
		#obsId#,
		#mimeType.mimeTypeId#,
		#urn#,
		#complexValue#
		);
</insert>

<!-- ************************************************************ -->
<!-- ** Read                                                   ** -->
<!-- ************************************************************ -->

<resultMap id="complexObsResult" class="org.openmrs.ComplexObs" extends="org.openmrs.Obs.obsResult">
	<result property="obsId" column="obs_id" />
	<result property="mimeType" column="mime_type_id" select="getMimeType" />
	<result property="urn" column="urn" />
	<result property="complexValue" column="complex_value" />
</resultMap>

<select id="getComplexObs" parameterClass="int" resultMap="complexObsResult">
	SELECT
		o.*,
		co.mime_type_id,
		co.urn,
		co.complex_value
	FROM
		complex_obs co inner join obs o on
			co.obs_id = o.obs_id
	WHERE
		o.obs_id = #value#
</select>

<!-- ************************************************************ -->
<!-- ** Update                                                 ** -->
<!-- ************************************************************ -->

<update id="updateComplexObs" parameterClass="org.openmrs.ComplexObs">
	UPDATE
		complex_obs
	SET
		mime_type_id = #mimeType.mimeTypeId#,
		urn = #urn#,
		complex_value = #complexValue#
	WHERE
		obs_id = #obsId#
</update>

<!-- ************************************************************ -->
<!-- ** Delete                                                 ** -->
<!-- ************************************************************ -->

<delete id="deleteComplexObs" parameterClass="int">
	DELETE FROM complex_obs WHERE obs_id = #value#
</delete>

</sqlMap>