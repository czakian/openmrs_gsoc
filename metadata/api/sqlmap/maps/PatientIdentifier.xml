<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="org.openmrs.PatientIdentifier">

<!-- ************************************************************ -->
<!-- ** Creation                                               ** -->
<!-- ************************************************************ -->

<insert id="createPatientIdentifier" parameterClass="org.openmrs.PatientIdentifier">
	INSERT INTO patient_identifier
		(
		patient_id,
		identifier,
		identifier_type,
		location_id,
		creator,
		date_created
		)
	VALUES
		(
		#patient.patientId#,
		#identifier#,
		#identifierType.patientIdentifierTypeId#,
		#location.locationId#,
		#creator.userId#,
		NOW()
		);
</insert>

<!-- ************************************************************ -->
<!-- ** Read                                                   ** -->
<!-- ************************************************************ -->

<resultMap id="patientIdentifierResult" class="org.openmrs.PatientIdentifier">
	<result property="patient" column="patient_id" select="getPatient" />
	<result property="identifier" column="identifier" />
	<result property="identifierType" column="identifier_type" select="getPatientIdentifierType" />
	<result property="location" column="location_id" select="getLocation" />
	<result property="creator" column="creator" select="getUser" />
	<result property="dateCreated" column="date_created" />
	<result property="voided" column="voided" nullValue="false" />
	<result property="voidedBy" column="voided_by" select="getUser" />
	<result property="dateVoided" column="date_voided" />
	<result property="voidReason" column="void_reason" />
</resultMap>

<select id="getPatientIdentifier" parameterClass="org.openmrs.PatientIdentifier"
        resultMap="patientIdentifierResult">
	SELECT * FROM patient_identifier
	WHERE
		patient_id = #patient.patientId# AND
		identifier = #identifier# AND
		identifier_type = #identifierType.patientIdentifierTypeId# AND
		location_id = #location.locationId#
</select>

<select id="getPatientIdentifierByPatientId" parameterClass="int"
        resultMap="patientIdentifierResult">
	SELECT * FROM patient_identifier WHERE patient_id = #value#
</select>

<!-- ************************************************************ -->
<!-- ** Update                                                 ** -->
<!-- ************************************************************ -->

<update id="updatePatientIdentifier" parameterClass="org.openmrs.PatientIdentifier">
	UPDATE patient_identifier
	SET (
		patient_id = #patient.patientId#,
		identifier = #identifier#,
		identifier_type = #identifierType.patientIdentifierTypeId#,
		location_id = #location.locationId#
		);
</update>

<!-- ************************************************************ -->
<!-- ** Deletion                                               ** -->
<!-- ************************************************************ -->

<delete id="deletePatientIdentifier" parameterClass="org.openmrs.PatientIdentifier">
	DELETE FROM patient_identifier
	WHERE
		patient_id = #patient.patientId# AND
		identifier = #identifier# AND
		identifier_type = #identifierType.patientIdentifierTypeId# AND
		location_id = #location.locationId#		
</delete>

<update id="voidPatientIdentifier" parameterClass="org.openmrs.PatientIdentifier">
	UPDATE
		patient_identifier
	SET
		voided = 1,
		voided_by = #voidedBy#,
		date_voided = NOW(),
		void_reason = #voidReason#
	WHERE
		patient_id = #patient.patientId# AND
		identifier = #identifier# AND
		identifier_type = #identifierType.patientIdentifierTypeId# AND
		location_id = #location.locationId#		
</update>

<update id="unvoidPatientIdentifier" parameterClass="org.openmrs.PatientIdentifier">
	UPDATE
		patient_identifier
	SET
		voided = 0,
		voided_by = NULL,
		date_voided = NULL,
		void_reason = NULL
	WHERE
		patient_id = #patient.patientId# AND
		identifier = #identifier# AND
		identifier_type = #identifierType.patientIdentifierTypeId# AND
		location = #location.locationId#		
</update>

</sqlMap>