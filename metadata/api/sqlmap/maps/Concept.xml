<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- ### WORK IN PROGRESS -BURKE ### -->

<sqlMap namespace="org.openmrs.Concept">

<!-- ************************************************************ -->
<!-- ** Creation                                               ** -->
<!-- ************************************************************ -->

<insert id="creatConcept" parameterClass="org.openmrs.Concept">
	INSERT INTO concept
		(
		concept_id,
		retired,
		name,
		short_name,
		description,
		datatype_id,
		class_id,
		units,
		icd10,
		loinc,
		version,
		creator,
		date_created
		)
	VALUES
		(
		#conceptId#,
		#retired#,
		#name#,
		#shortName#,
		#description#,
		#conceptDatatype.conceptDatatypeId#,
		#conceptClass.conceptClassId#,
		#units#,
		#icd10#,
		#loinc#,
		#version#,
		#creator.userId#,
		NOW()
		);
</insert>

<!-- ************************************************************ -->
<!-- ** Read                                                   ** -->
<!-- ************************************************************ -->

<resultMap id="conceptResult" class="org.openmrs.Concept">
	<result property="conceptId" column="concept_id" />
	<result property="retired" column="retired" nullValue="false" />
	<result property="name" column="name" />
	<result property="shortName" column="short_name" />
	<result property="description" column="description" />
	<result property="conceptDatatype" column="datatype_id" select="getConceptDatatype" />
	<result property="conceptClass" column="class_id" select="getConceptClass" />
	<result property="units" column="units" />
	<result property="icd10" column="icd10" />
	<result property="loinc" column="loinc" />
	<result property="version" column="version" />
	<result property="creator" column="creator" select="getUser" />
	<result property="dateCreated" column="date_created" />
	<result property="changedBy" column="changed_by" select="getUser" />
	<result property="dateChanged" column="date_changed" />
	<result property="answers" column="concept_id" select="getConceptAnswerByConceptId" />
	<result property="names" column="concept_id" select="getConceptNameByConceptId" />
</resultMap>

<select id="getConcept" parameterClass="int" resultMap="conceptResult">
	SELECT * FROM concept WHERE concept_id = #value#
</select>

<select id="getAllConcepts" resultMap="conceptResult">
	SELECT * FROM concept
</select>

<!-- ************************************************************ -->
<!-- ** Update                                                 ** -->
<!-- ************************************************************ -->

<update id="updateConcept" parameterClass="org.openmrs.Concept">
	UPDATE
		concept
	SET
		retired = #retired#,
		name = #name#,
		short_name = #shortName#,
		description #description#,
		datatype_id = #conceptDatatype.conceptDatatypeId#,
		class_id = #conceptClass.conceptClassId#,
		units = #units#,
		icd10 = #icd10#,
		loinc = #loinc#,
		version = #version#,
		changed_by = #changedBy.userId#,
		date_changed = NOW()
	WHERE
		concept_id = #conceptId#
</update>

<!-- ************************************************************ -->
<!-- ** Deletion                                               ** -->
<!-- ************************************************************ -->

<delete id="deleteConcept" parameterClass="org.openmrs.Concept">
	DELETE FROM concept WHERE concept_id = #conceptId#
</delete>

</sqlMap>