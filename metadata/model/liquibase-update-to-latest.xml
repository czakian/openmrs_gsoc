<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
	
	<!-- 
	
		See http://www.liquibase.org/manual/home#available_database_refactorings 
		for a list of supported elements and attributes 
		
	-->
	
	
	<changeSet id="0" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="The update-to-latest.sql file needs to be run on this db.">
				<![CDATA[
				SELECT case when REPLACE(property_value, '.', '0') >= REPLACE('1.4.0.20', '.', '0') then 'database_version greater than 1.4.0.20' else 'The update-to-latest.sql file needs to be run on this db.' end FROM global_property WHERE property = 'database_version';
				]]>
			</sqlCheck>
		</preConditions>
		<comment>Run the old sqldiff file to get database up to the 1.4.0.20 version if needed. (Requires 'mysql' to be on the PATH)</comment>
		<customChange class="org.openmrs.util.databasechange.SourceMySqldiffFile">
			<param name="sqlFile">update-to-1.4.2.01-db.mysqldiff.sql</param>
		</customChange>
	</changeSet>
	
	<changeSet id="1" author="upul">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="person_attribute_type" columnName="edit_privilege"/></not>
		</preConditions>
		<comment>
			Add the column to person_attribute type to connect each type to a privilege
		</comment>
		<addColumn tableName="person_attribute_type">
			<column name="edit_privilege" type="varchar(255)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="2" author="upul">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="privilege_which_can_edit"/></not>
		</preConditions>
		<comment>
			Create the foreign key from the privilege required for to edit
			a person attribute type and the privilege.privilege column
		</comment>
		<addForeignKeyConstraint constraintName="privilege_which_can_edit"
			baseTableName="person_attribute_type" baseColumnNames="edit_privilege"
			referencedTableName="privilege" referencedColumnNames="privilege"
		    />
    </changeSet>
    
	<changeSet id="200811261102" author="bwolfe">
		<comment>
			Fix field property for new Tribe person attribute
		</comment>
		<update tableName="field">
			<column name="default_value" value="$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}"/>
			<where>default_value='$!{patient.getTribe().getTribeId()}^$!{patient.getTribe().getName()}'</where>
		</update>
    </changeSet>
    
	<changeSet id="200805281223" author="bmckown">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="concept_complex"/></not>
		</preConditions>
		<comment>
			Create the concept_complex table
		</comment>
		<createTable tableName="concept_complex">
			<column name="concept_id" type="int">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="handler" type="varchar(255)"/>
		</createTable>
		
		<addForeignKeyConstraint constraintName="concept_attributes"
			baseTableName="concept_complex" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id"
			/>		
    </changeSet>
    
	<changeSet id="200805281224" author="bmckown">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="obs" columnName="value_complex"/></not>
		</preConditions>
		<comment>
			Adding the value_complex column to obs.  This may take a long time if you have a large number of observations.
		</comment>
		<addColumn tableName="obs">
			<column name="value_complex" type="varchar(255)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200805281225" author="bmckown">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT count(*) FROM concept_datatype where name='Complex';
				]]>
			</sqlCheck>
		</preConditions>
		<comment>
			Adding a 'complex' Concept Datatype
		</comment>
		<insert tableName="concept_datatype">
			<column name="name" value="Complex"/>
			<column name="hl7_abbreviation" value="ED"/>
			<column name="description" value="Complex value.  Analogous to HL7 Embedded Datatype"/>
			<column name="creator" valueNumeric="1"/>
			<column name="date_created" valueDate="2008-05-28T12:25:34" />
		</insert>
	</changeSet>
	
	<changeSet id="200805281226" author="bmckown">
		<preConditions onFail="MARK_RAN">
			<tableExists tableName="complex_obs"/>
		</preConditions>
		<comment>
			Dropping the mimetype and complex_obs tables as they aren't needed in the new complex obs setup
		</comment>
		
		<dropTable tableName="complex_obs"/>
		<dropTable tableName="mime_type"/>
		
	</changeSet>
	
	<changeSet id="200809191226" author="smbugua">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="hl7_in_archive" columnName="message_state"/></not>
		</preConditions>
		<comment>
			Adding the hl7 archive message_state column so that archives can be tracked
			
			(preCondition database_version check in place because this change was in the old format in trunk for a while)
		</comment>
		<addColumn tableName="hl7_in_archive">
			<column name="message_state" type="int(1)" defaultValueNumeric="0" remarks="2=processed, 4=deleted" />
		</addColumn>
	</changeSet>

	<changeSet id="200809191927" author="smbugua">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="hl7_in_queue" columnName="message_state"/></not>
		</preConditions>
		<comment>
			Adding the hl7 archive message_state column so that archives can be tracked
		</comment>
		<renameColumn tableName="hl7_in_queue" oldColumnName="state" newColumnName="message_state" columnDataType="int(1)"/>
		
		<modifyColumn tableName="hl7_in_queue">
			<column name="message_state" type="int(1)" defaultValueNumeric="0" remarks="0=pending, 1=processing, 2=processed, 3=error">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200901101524" author="Knoll_Frank">
		<comment>
			Changing datatype of drug.retire_reason from DATETIME to varchar(255)
		</comment>
		<modifyColumn tableName="drug">
		    <column name="retire_reason" type="varchar(255)"/>
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200901130950" author="bwolfe">
		<comment>
			Remove Manage Tribes and View Tribes privileges from all roles
		</comment>
		
		<delete tableName="role_privilege">
			<where>privilege='Manage Tribes' and not exists (select * from privilege where privilege = 'Manage Tribes')</where>
		</delete>
		
		<delete tableName="role_privilege">
			<where>privilege='View Tribes' and not exists (select * from privilege where privilege = 'View Tribes')</where>
		</delete>
	</changeSet>
	
	<changeSet id="200901130951" author="bwolfe">
		<comment>
			Remove Manage Mime Types, View Mime Types, and Purge Mime Types privilege
		</comment>
		
		<delete tableName="role_privilege">
			<where>privilege in ('Manage Mime Types', 'View Mime Types', 'Purge Mime Types')</where>
		</delete>
		
		<delete tableName="privilege">
			<where>privilege in ('Manage Mime Types', 'View Mime Types', 'Purge Mime Types')</where>
		</delete>
	</changeSet>
	
	<changeSet id="200901161126" author="bwolfe">
		<comment>
			Removed the database_version global property
		</comment>
		
		<delete tableName="global_property">
			<where>property = 'database_version'</where>
		</delete>
		
	</changeSet>
	
	<changeSet id="20090121-0949" author="bwolfe">
		<comment>
			Switched the default xslt to use PV1-19 instead of PV1-1
		</comment>
		
		<!-- using the <sql> tag instead of the <update> tag here so that xml syntax highlighting doesn't bog down editors -->
		<sql splitStatements="false">
			<![CDATA[
				UPDATE form
				SET xslt = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>'
				WHERE xslt LIKE '%\r\n@version 1.9.6\r\n%';
			]]>
		</sql>
	
	</changeSet>
	
	<changeSet id="20090122-0853" author="bwolfe">
		<preConditions onFail="CONTINUE">
			<not><dbms type="hsql" /></not> <!-- skip over this changeset in unit tests -->
		</preConditions>
		<comment>
			Remove duplicate concept name tags
		</comment>
		
		<sql>
			UPDATE 
				concept_name_tag_map map 
			SET 
				concept_name_tag_id = (SELECT 
										 min(concept_name_tag_id)
									   FROM concept_name_tag
									   WHERE 
									     tag = (select tag from concept_name_tag where concept_name_tag_id = map.concept_name_tag_id)
									  );
		</sql>
		
		<!-- Copy the concept_name_map_ids to a new table -->
		<addLookupTable
			existingTableName="concept_name_tag" existingColumnName="concept_name_tag_id"
			newTableName="tmp_concept_name_tag_duplicates" newColumnName="concept_name_tag_id" 
			newColumnDataType="int" constraintName="concept_name_tag_ids_dupes"
		/>
		
		<dropForeignKeyConstraint
			constraintName="concept_name_tag_ids_dupes"
			baseTableName="concept_name_tag" />
		
		<!-- Leave only ids that have duplicates in the table -->
		<delete tableName="tmp_concept_name_tag_duplicates">
			<where>concept_name_tag_id not in (select concept_name_tag_id from concept_name_tag where tag in (select tag from concept_name_tag group by tag having count(*) > 1))</where>
		</delete>
		
		<!-- Now delete all  -->
		<delete tableName="concept_name_tag">
			<where>
				concept_name_tag_id in (select concept_name_tag_id from tmp_concept_name_tag_duplicates)
				and
				concept_name_tag_id not in (select distinct(concept_name_tag_id) from concept_name_tag_map)
			</where>
		</delete>
		
		<dropTable tableName="tmp_concept_name_tag_duplicates" />
		
	</changeSet>
	
	<changeSet id="20090123-0305" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="concept_name_tag_unique_tags" />
			</not>
		</preConditions>
		<comment>
			Add unique constraint to the tags table
		</comment>
		
		<addUniqueConstraint tableName="concept_name_tag" columnNames="tag" constraintName="concept_name_tag_unique_tags"/>
		
	</changeSet>
	
	<changeSet id="20090224-1229" author="Keelhaul+bwolfe">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="location_tag"/></not>
		</preConditions>
		<comment>
			Add location tags table
		</comment>
		
		<createTable tableName="location_tag">
			<column name="location_tag_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(255)" defaultValue="null"/>
			<column name="creator" type="int(11)" >
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime" >
				<constraints nullable="false"/>
			</column>
			<column name="retired" type="tinyint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int(11)" />
			<column name="date_retired" type="datetime" />
			<column name="retired_reason" type="varchar(255)" defaultValue="null"/>
		</createTable>
		
		<addForeignKeyConstraint constraintName="location_tag_creator"
			baseTableName="location_tag" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id"
			/>
		<addForeignKeyConstraint constraintName="location_tag_retired_by"
			baseTableName="location_tag" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id"
			/>
	</changeSet>
	
	<changeSet id="20090224-1250" author="Keelhaul+bwolfe">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="location_tag_map"/></not>
		</preConditions>
		<comment>
			Add location tag map table
		</comment>
		
		<createTable tableName="location_tag_map">
			<column name="location_id" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="location_tag_id" type="int">
				<constraints nullable="false"/>
			</column>
		</createTable>
		
		<addForeignKeyConstraint constraintName="location_tag_map_location"
			baseTableName="location_tag_map" baseColumnNames="location_id"
			referencedTableName="location" referencedColumnNames="location_id"
			/>
	    <addForeignKeyConstraint constraintName="location_tag_map_tag"
			baseTableName="location_tag_map" baseColumnNames="location_tag_id"
			referencedTableName="location_tag" referencedColumnNames="location_tag_id"
			/>
		<addPrimaryKey tableName="location_tag_map"
			columnNames="location_id,location_tag_id"
			constraintName="key_for_location_tag_map"/>
		
	</changeSet>
	
	<changeSet id="20090224-1256" author="Keelhaul+bwolfe">
		<preConditions>
			<not><columnExists tableName="location" columnName="parent_location"/></not>
		</preConditions>
		<comment>
			Add parent_location column to location table
		</comment>
		
		<addColumn tableName="location">
			<column name="parent_location" type="int(11)" />
		</addColumn>
		
		<addForeignKeyConstraint constraintName="parent_location"
			baseTableName="location" baseColumnNames="parent_location"
			referencedTableName="location" referencedColumnNames="location_id"
			/>
	</changeSet>
	
	<changeSet id="20090225-1551" author="dthomas">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location_tag" columnName="name"/>
		</preConditions>
		<comment>
			Change location_tag.name to location_tag.tag and location_tag.retired_reason to location_tag.retire_reason
		</comment>
		<renameColumn tableName="location_tag"
   			 oldColumnName="name" newColumnName="tag" columnDataType="varchar(50)"/>
		<renameColumn tableName="location_tag"
   			 oldColumnName="retired_reason" newColumnName="retire_reason" columnDataType="varchar(255)"/>
	</changeSet>

	<changeSet id="02232009-1141" author="nribeka">
		<comment>
			Modify the password column to fit the output of SHA-512 function
		</comment>
		
		<modifyColumn tableName="users">
			<column name="password" type="varchar(128)"/>
			<column name="salt" type="varchar(128)"/>
		</modifyColumn>
	</changeSet>	
	
	<changeSet id="20090301-1259" author="bwolfe">
		<comment>
			Fixes the description for name layout global property
		</comment>
		
		<update tableName="global_property">
			<column name="description" value="Format in which to display the person names.  Valid values are short, long"/>
			<where>property='layout.name.format'</where>
		</update>
		<update tableName="global_property">
			<column name="property_value" value="short"/>
			<where>property='layout.name.format' and property_value='Format in which to display the person names.  Valid values are short, long'</where>
		</update>
		
	</changeSet>
	
	<changeSet id="20090214-2246" author="isherman">
		<preConditions onFail="MARK_RAN">
			<dbms type="mysql" />
		</preConditions>
		<comment>
			Add weight and cd4 to patientGraphConcepts user property (mysql specific)
		</comment>
		
		<sql>
			UPDATE user_property
				SET property_value = CONCAT(
					'-', 
					(SELECT property_value FROM global_property WHERE property = 'concept.weight'),
					'-',
					(SELECT property_value FROM global_property WHERE property = 'concept.cd4_count'),
					property_value
				) WHERE property = 'patientGraphConcepts';			
		</sql>
	</changeSet>
	
	<changeSet id="20090214-2247" author="isherman">
		<preConditions onFail="MARK_RAN">
			<or>
				<dbms type="postgresql" />
				<dbms type="oracle" />
				<dbms type="db2" />
			</or>
		</preConditions>
		<comment>
			Add weight and cd4 to patientGraphConcepts user property (using standard sql)
		</comment>
		
		<sql>
			UPDATE user_property
				SET property_value = 
					'-' || 
					(SELECT property_value FROM global_property WHERE property = 'concept.weight') ||
					'-' ||
					(SELECT property_value FROM global_property WHERE property = 'concept.cd4_count') ||
					property_value
				) WHERE property = 'patientGraphConcepts';			
		</sql>
	</changeSet>
	
	<changeSet id="20090214-2248" author="isherman">
		<preConditions onFail="MARK_RAN">
			<dbms type="mssql" />
		</preConditions>
		<comment>
			Add weight and cd4 to patientGraphConcepts user property (mssql specific)
		</comment>
		
		<sql>
			UPDATE user_property
				SET property_value = 
					'-' + 
					(SELECT property_value FROM global_property WHERE property = 'concept.weight') +
					'-' +
					(SELECT property_value FROM global_property WHERE property = 'concept.cd4_count') +
					property_value
				) WHERE property = 'patientGraphConcepts';			
		</sql>
	</changeSet>
	
	<changeSet id="20090316-1008" author="vanand">
		<validCheckSum>cf32d07af2933e9a3555395737b5142</validCheckSum><!-- old checksum before adding in person.birthdate_estimated cleanup -->
		<validCheckSum>fcdde237e04473db1e6fd16f56bf80e9</validCheckSum><!-- new checksum after adding in person.birthdate_estimated cleanup -->
		<comment>
			Change column types of all boolean columns to smallint. The columns used to be either tinyint(4) or MySQL's BIT.
			(This may take a while on large patient or obs tables)
		</comment>
		
		<modifyColumn tableName="cohort">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="is_set" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept_class">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept_datatype">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept_name">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept_name_tag">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="concept_numeric">
			<column name="precise" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<update tableName="concept_source">
			<column name="voided" value="0" />
			<where>voided is null</where>
		</update>
		<modifyColumn tableName="concept_source">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="drug">
			<column name="combination" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="drug_order">
			<column name="prn" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="complex" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="encounter">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="encounter_type">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="field">
			<column name="select_multiple" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="field_type">
			<column name="is_set" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="form">
			<column name="published" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>		
		<modifyColumn tableName="form_field">
			<column name="required" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>		
		<modifyColumn tableName="location_tag">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>		
		<modifyColumn tableName="obs">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>		
		<modifyColumn tableName="order_type">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="orders">
			<column name="discontinued" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="patient">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="patient_identifier">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="patient_identifier_type">
			<column name="check_digit" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="required" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="patient_program">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="patient_state">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<update tableName="person">
			<column name="birthdate_estimated" value="0" />
			<where>birthdate_estimated is null</where>
		</update>
		<modifyColumn tableName="person">
			<column name="birthdate_estimated" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="dead" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="person_address">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="person_attribute">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="person_attribute_type">
			<column name="searchable" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="person_name">
			<column name="preferred" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="program">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="program_workflow">
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="program_workflow_state">
			<column name="initial" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="terminal" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="relationship">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="report_object">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
		<modifyColumn tableName="users">
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200903210905" author="mseaton">
		<preConditions onFail="MARK_RAN">
			<not><tableExists tableName="serialized_object"/></not>
		</preConditions>
		<comment>
			Add a table to enable generic storage of serialized objects
		</comment>		
		<createTable tableName="serialized_object">
			<column name="serialized_object_id" type="int" autoIncrement="true">
				<constraints nullable="false" primaryKey="true"/>
			</column>			
			<column name="name" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(5000)"/>
			<column name="type" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="subtype" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="serialization_class" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="serialized_data" type="text">
				<constraints nullable="false"/>
			</column>
			<column name="date_created" type="DATETIME">
				<constraints nullable="false"/>
			</column>
			<column name="creator" type="int">
				<constraints nullable="false"/>
			</column>
			<column name="date_changed" type="DATETIME" />
			<column name="changed_by" type="int"/>
			<column name="retired" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="date_retired" type="DATETIME"/>
			<column name="retired_by" type="int"/>
			<column name="retire_reason" type="varchar(1000)"/>
		</createTable>

		<addForeignKeyConstraint constraintName="serialized_object_creator" 
								 baseTableName="serialized_object" baseColumnNames="creator"
								 referencedTableName="users" referencedColumnNames="user_id"
		/>
		<addForeignKeyConstraint constraintName="serialized_object_changed_by" 
								 baseTableName="serialized_object" baseColumnNames="changed_by"
								 referencedTableName="users" referencedColumnNames="user_id"
		/>
		<addForeignKeyConstraint constraintName="serialized_object_retired_by" 
								 baseTableName="serialized_object" baseColumnNames="retired_by"
								 referencedTableName="users" referencedColumnNames="user_id"
		/>
	</changeSet>
	
	<changeSet id="200904091023" author="bwolfe">
		<comment>
			Remove Manage Tribes and View Tribes privileges from the privilege table and role_privilege table.
			The privileges will be recreated by the Tribe module if it is installed.
		</comment>
		
		<delete tableName="role_privilege">
			<where>privilege='Manage Tribes'</where>
		</delete>
		
		<delete tableName="role_privilege">
			<where>privilege='View Tribes'</where>
		</delete>
		
		<delete tableName="privilege">
			<where>privilege='Manage Tribes'</where>
		</delete>
		
		<delete tableName="privilege">
			<where>privilege='View Tribes'</where>
		</delete>
	</changeSet>
	
	<changeSet author="Cory McCarthy" id="20090408-1298">
		<comment>Changed the datatype for encounter_type to 'text' instead of just 50 chars</comment>
		<modifyColumn tableName="encounter_type">
			<column name="description" type="text" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200905150814" author="bwolfe">
		<comment>Deleting invalid concept words</comment>
		<delete tableName="concept_word">
			<where>concept_name_id = 0</where>
		</delete>
	</changeSet>
	
	<changeSet id="200905071626" author="bwolfe" failOnError="false">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="concept_word_concept_idx"/>
			</not>
		</preConditions>
	
		<comment>
			Add an index to the concept_word.concept_id column (This update may fail if it already exists)
		</comment>
		
		<createIndex tableName="concept_word" indexName="concept_word_concept_idx">
			<column name="concept_id" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090402-1515-38-cohort" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="cohort" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to cohort table</comment>
		<addColumn tableName="cohort">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept table</comment>
		<addColumn tableName="concept">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_answer" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_answer table</comment>
		<addColumn tableName="concept_answer">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_class" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_class" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_class table</comment>
		<addColumn tableName="concept_class">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_datatype" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_datatype" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_datatype table</comment>
		<addColumn tableName="concept_datatype">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_description" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_description" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_description table</comment>
		<addColumn tableName="concept_description">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_map" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_map" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_map table</comment>
		<addColumn tableName="concept_map">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_name" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_name table</comment>
		<addColumn tableName="concept_name">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_name_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_name_tag" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_name_tag table</comment>
		<addColumn tableName="concept_name_tag">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_proposal" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_proposal" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_proposal table</comment>
		<addColumn tableName="concept_proposal">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_set" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_set" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_set table</comment>
		<addColumn tableName="concept_set">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_source" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_source table</comment>
		<addColumn tableName="concept_source">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-concept_state_conversion" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="concept_state_conversion" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to concept_state_conversion table</comment>
		<addColumn tableName="concept_state_conversion">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-drug" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="drug" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to drug table</comment>
		<addColumn tableName="drug">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-encounter" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="encounter" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to encounter table</comment>
		<addColumn tableName="encounter">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-encounter_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="encounter_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to encounter_type table</comment>
		<addColumn tableName="encounter_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field table</comment>
		<addColumn tableName="field">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field_answer" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field_answer table</comment>
		<addColumn tableName="field_answer">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-field_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="field_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to field_type table</comment>
		<addColumn tableName="field_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-form" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="form" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to form table</comment>
		<addColumn tableName="form">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-form_field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="form_field" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to form_field table</comment>
		<addColumn tableName="form_field">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-global_property" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="global_property" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to global_property table</comment>
		<addColumn tableName="global_property">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_archive" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_archive" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_archive table</comment>
		<addColumn tableName="hl7_in_archive">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_error" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_error" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_error table</comment>
		<addColumn tableName="hl7_in_error">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_in_queue" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_in_queue" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_in_queue table</comment>
		<addColumn tableName="hl7_in_queue">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-hl7_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="hl7_source" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to hl7_source table</comment>
		<addColumn tableName="hl7_source">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-location" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="location" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to location table</comment>
		<addColumn tableName="location">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-location_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="location_tag" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to location_tag table</comment>
		<addColumn tableName="location_tag">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-note" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="note" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to note table</comment>
		<addColumn tableName="note">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-notification_alert" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_alert" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_alert table</comment>
		<addColumn tableName="notification_alert">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-notification_template" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_template" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_template table</comment>
		<addColumn tableName="notification_template">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-obs" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="obs" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to obs table</comment>
		<addColumn tableName="obs">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-order_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="order_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to order_type table</comment>
		<addColumn tableName="order_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-orders" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="orders" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to orders table</comment>
		<addColumn tableName="orders">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_identifier" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_identifier_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_identifier_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_identifier_type table</comment>
		<addColumn tableName="patient_identifier_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_program" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_program table</comment>
		<addColumn tableName="patient_program">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-patient_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="patient_state" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to patient_state table</comment>
		<addColumn tableName="patient_state">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person table</comment>
		<addColumn tableName="person">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_address" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_address" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_address table</comment>
		<addColumn tableName="person_address">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_attribute" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_attribute" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_attribute table</comment>
		<addColumn tableName="person_attribute">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_attribute_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_attribute_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_attribute_type table</comment>
		<addColumn tableName="person_attribute_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-person_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="person_name" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to person_name table</comment>
		<addColumn tableName="person_name">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-privilege" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="privilege" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to privilege table</comment>
		<addColumn tableName="privilege">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program table</comment>
		<addColumn tableName="program">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program_workflow" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program_workflow" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program_workflow table</comment>
		<addColumn tableName="program_workflow">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-program_workflow_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="program_workflow_state" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to program_workflow_state table</comment>
		<addColumn tableName="program_workflow_state">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-relationship" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to relationship table</comment>
		<addColumn tableName="relationship">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-relationship_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="relationship_type" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-report_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="report_object" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to report_object table</comment>
		<addColumn tableName="report_object">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-report_schema_xml" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="report_schema_xml" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to report_schema_xml table</comment>
		<addColumn tableName="report_schema_xml">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-role" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="role" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to role table</comment>
		<addColumn tableName="role">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	<changeSet id="20090402-1515-38-serialized_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="serialized_object" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to serialized_object table</comment>
		<addColumn tableName="serialized_object">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>


	<changeSet id="20090402-1516-cohort" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in cohort table via built in uuid function.</comment>
		<update tableName="cohort" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept table via built in uuid function.</comment>
		<update tableName="concept" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_answer table via built in uuid function.</comment>
		<update tableName="concept_answer" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_class" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_class table via built in uuid function.</comment>
		<update tableName="concept_class" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_datatype" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_datatype table via built in uuid function.</comment>
		<update tableName="concept_datatype" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_description" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_description table via built in uuid function.</comment>
		<update tableName="concept_description" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_map" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_map table via built in uuid function.</comment>
		<update tableName="concept_map" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_name table via built in uuid function.</comment>
		<update tableName="concept_name" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_name_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_name_tag table via built in uuid function.</comment>
		<update tableName="concept_name_tag" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_proposal" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_proposal table via built in uuid function.</comment>
		<update tableName="concept_proposal" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_set" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_set table via built in uuid function.</comment>
		<update tableName="concept_set" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_source table via built in uuid function.</comment>
		<update tableName="concept_source" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-concept_state_conversion" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in concept_state_conversion table via built in uuid function.</comment>
		<update tableName="concept_state_conversion" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-drug" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in drug table via built in uuid function.</comment>
		<update tableName="drug" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-encounter" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in encounter table via built in uuid function.</comment>
		<update tableName="encounter" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-encounter_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in encounter_type table via built in uuid function.</comment>
		<update tableName="encounter_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field table via built in uuid function.</comment>
		<update tableName="field" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field_answer table via built in uuid function.</comment>
		<update tableName="field_answer" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-field_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in field_type table via built in uuid function.</comment>
		<update tableName="field_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-form" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in form table via built in uuid function.</comment>
		<update tableName="form" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-form_field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in form_field table via built in uuid function.</comment>
		<update tableName="form_field" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-global_property" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in global_property table via built in uuid function.</comment>
		<update tableName="global_property" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_archive" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_archive table via built in uuid function.</comment>
		<update tableName="hl7_in_archive" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_error" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_error table via built in uuid function.</comment>
		<update tableName="hl7_in_error" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_in_queue" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_in_queue table via built in uuid function.</comment>
		<update tableName="hl7_in_queue" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-hl7_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in hl7_source table via built in uuid function.</comment>
		<update tableName="hl7_source" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-location" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in location table via built in uuid function.</comment>
		<update tableName="location" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-location_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in location_tag table via built in uuid function.</comment>
		<update tableName="location_tag" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-note" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in note table via built in uuid function.</comment>
		<update tableName="note" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-notification_alert" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_alert table via built in uuid function.</comment>
		<update tableName="notification_alert" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-notification_template" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_template table via built in uuid function.</comment>
		<update tableName="notification_template" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-obs" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in obs table via built in uuid function.</comment>
		<update tableName="obs" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-order_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in order_type table via built in uuid function.</comment>
		<update tableName="order_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-orders" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in orders table via built in uuid function.</comment>
		<update tableName="orders" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_identifier" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_identifier table via built in uuid function.</comment>
		<update tableName="patient_identifier" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_identifier_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_identifier_type table via built in uuid function.</comment>
		<update tableName="patient_identifier_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_program table via built in uuid function.</comment>
		<update tableName="patient_program" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-patient_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in patient_state table via built in uuid function.</comment>
		<update tableName="patient_state" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person table via built in uuid function.</comment>
		<update tableName="person" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_address" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_address table via built in uuid function.</comment>
		<update tableName="person_address" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_attribute" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_attribute table via built in uuid function.</comment>
		<update tableName="person_attribute" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_attribute_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_attribute_type table via built in uuid function.</comment>
		<update tableName="person_attribute_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-person_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in person_name table via built in uuid function.</comment>
		<update tableName="person_name" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-privilege" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in privilege table via built in uuid function.</comment>
		<update tableName="privilege" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program table via built in uuid function.</comment>
		<update tableName="program" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program_workflow" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program_workflow table via built in uuid function.</comment>
		<update tableName="program_workflow" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-program_workflow_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in program_workflow_state table via built in uuid function.</comment>
		<update tableName="program_workflow_state" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-relationship" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in relationship table via built in uuid function.</comment>
		<update tableName="relationship" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-relationship_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in relationship_type table via built in uuid function.</comment>
		<update tableName="relationship_type" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-report_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in report_object table via built in uuid function.</comment>
		<update tableName="report_object" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-report_schema_xml" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in report_schema_xml table via built in uuid function.</comment>
		<update tableName="report_schema_xml" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-role" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in role table via built in uuid function.</comment>
		<update tableName="role" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	<changeSet id="20090402-1516-serialized_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in serialized_object table via built in uuid function.</comment>
		<update tableName="serialized_object" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>

	<changeSet id="20090402-1517" author="bwolfe">
		<validCheckSum>1b6141be59a8a243b9e56d0aad952af</validCheckSum> <!-- checksum from before idExceptions added -->
		<validCheckSum>89cc7a14b0582f157ea2dbb9de092fd</validCheckSum> <!-- current checksum with idExceptions param added -->
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to all rows in all columns via a java class. (This will take a long time on large databases)
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				cohort concept concept_answer concept_class concept_datatype concept_description 
				concept_map concept_name concept_name_tag concept_proposal
				concept_set concept_source concept_state_conversion drug
				encounter encounter_type field field_answer field_type form form_field global_property hl7_in_archive 
				hl7_in_error hl7_in_queue hl7_source location location_tag note notification_alert 
				notification_template obs order_type orders patient_identifier 
				patient_identifier_type patient_program patient_state person person_address person_attribute 
				person_attribute_type person_name privilege program program_workflow program_workflow_state relationship 
				relationship_type report_object report_schema_xml role serialized_object
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				field_answer_id=field_id|role_id=role|privilege_id=privilege|global_property_id=property|notification_alert_id=alert_id
				|notification_template_id=template_id|orders_id=order_id|report_schema_xml_id=report_schema_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20090402-1518" author="bwolfe">
		<validCheckSum>64e353f08027fb48155b5be8a69cfca</validCheckSum> <!-- Checksum when datatype was "uuid" -->
		<validCheckSum>dfaf705d7776613e619dedf3e06d7640</validCheckSum><!-- New checksum when datatype is "char(38)" -->
		<comment>
			Now that UUID generation is done, set the uuid columns to not "NOT NULL" 
		</comment>
		
		<addNotNullConstraint tableName="cohort" columnName="uuid" columnDataType="char(38)"/>
		<addNotNullConstraint tableName="concept" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_class" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_datatype" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_description" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_map" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_name_tag" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_proposal" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_set" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_source" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="concept_state_conversion" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="drug" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="encounter" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="encounter_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_answer" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="field_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="form_field" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="global_property" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_archive" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_error" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_in_queue" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="hl7_source" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="location" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="location_tag" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="note" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="notification_alert" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="notification_template" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="obs" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="order_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="orders" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_identifier" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_identifier_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="patient_state" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_address" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_attribute_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="person_name" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="privilege" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="program_workflow_state" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="relationship_type" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_object" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="report_schema_xml" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="role" columnName="uuid" columnDataType="char(38)" />
		<addNotNullConstraint tableName="serialized_object" columnName="uuid" columnDataType="char(38)" />
	</changeSet>

	
	<changeSet id="20090402-1519-cohort" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="cohort_uuid_index"/></not></preConditions>
		<comment>Creating unique index on cohort.uuid column</comment>
		<createIndex tableName="cohort" unique="true" indexName="cohort_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept.uuid column</comment>
		<createIndex tableName="concept" unique="true" indexName="concept_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_answer_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_answer.uuid column</comment>
		<createIndex tableName="concept_answer" unique="true" indexName="concept_answer_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_class" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_class_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_class.uuid column</comment>
		<createIndex tableName="concept_class" unique="true" indexName="concept_class_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_datatype" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_datatype_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_datatype.uuid column</comment>
		<createIndex tableName="concept_datatype" unique="true" indexName="concept_datatype_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_description" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_description_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_description.uuid column</comment>
		<createIndex tableName="concept_description" unique="true" indexName="concept_description_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_map" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_map_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_map.uuid column</comment>
		<createIndex tableName="concept_map" unique="true" indexName="concept_map_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_name_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_name.uuid column</comment>
		<createIndex tableName="concept_name" unique="true" indexName="concept_name_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_name_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_name_tag_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_name_tag.uuid column</comment>
		<createIndex tableName="concept_name_tag" unique="true" indexName="concept_name_tag_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_proposal" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_proposal_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_proposal.uuid column</comment>
		<createIndex tableName="concept_proposal" unique="true" indexName="concept_proposal_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_set" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_set_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_set.uuid column</comment>
		<createIndex tableName="concept_set" unique="true" indexName="concept_set_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_source_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_source.uuid column</comment>
		<createIndex tableName="concept_source" unique="true" indexName="concept_source_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-concept_state_conversion" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="concept_state_conversion_uuid_index"/></not></preConditions>
		<comment>Creating unique index on concept_state_conversion.uuid column</comment>
		<createIndex tableName="concept_state_conversion" unique="true" indexName="concept_state_conversion_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-drug" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="drug_uuid_index"/></not></preConditions>
		<comment>Creating unique index on drug.uuid column</comment>
		<createIndex tableName="drug" unique="true" indexName="drug_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-encounter" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="encounter_uuid_index"/></not></preConditions>
		<comment>Creating unique index on encounter.uuid column</comment>
		<createIndex tableName="encounter" unique="true" indexName="encounter_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-encounter_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="encounter_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on encounter_type.uuid column</comment>
		<createIndex tableName="encounter_type" unique="true" indexName="encounter_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field.uuid column</comment>
		<createIndex tableName="field" unique="true" indexName="field_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field_answer" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_answer_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field_answer.uuid column</comment>
		<createIndex tableName="field_answer" unique="true" indexName="field_answer_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-field_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="field_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on field_type.uuid column</comment>
		<createIndex tableName="field_type" unique="true" indexName="field_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-form" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="form_uuid_index"/></not></preConditions>
		<comment>Creating unique index on form.uuid column</comment>
		<createIndex tableName="form" unique="true" indexName="form_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-form_field" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="form_field_uuid_index"/></not></preConditions>
		<comment>Creating unique index on form_field.uuid column</comment>
		<createIndex tableName="form_field" unique="true" indexName="form_field_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-global_property" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="global_property_uuid_index"/></not></preConditions>
		<comment>Creating unique index on global_property.uuid column</comment>
		<createIndex tableName="global_property" unique="true" indexName="global_property_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_archive" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_archive_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_archive.uuid column</comment>
		<createIndex tableName="hl7_in_archive" unique="true" indexName="hl7_in_archive_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_error" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_error_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_error.uuid column</comment>
		<createIndex tableName="hl7_in_error" unique="true" indexName="hl7_in_error_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_in_queue" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_in_queue_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_in_queue.uuid column</comment>
		<createIndex tableName="hl7_in_queue" unique="true" indexName="hl7_in_queue_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-hl7_source" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="hl7_source_uuid_index"/></not></preConditions>
		<comment>Creating unique index on hl7_source.uuid column</comment>
		<createIndex tableName="hl7_source" unique="true" indexName="hl7_source_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-location" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="location_uuid_index"/></not></preConditions>
		<comment>Creating unique index on location.uuid column</comment>
		<createIndex tableName="location" unique="true" indexName="location_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-location_tag" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="location_tag_uuid_index"/></not></preConditions>
		<comment>Creating unique index on location_tag.uuid column</comment>
		<createIndex tableName="location_tag" unique="true" indexName="location_tag_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-note" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="note_uuid_index"/></not></preConditions>
		<comment>Creating unique index on note.uuid column</comment>
		<createIndex tableName="note" unique="true" indexName="note_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-notification_alert" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="notification_alert_uuid_index"/></not></preConditions>
		<comment>Creating unique index on notification_alert.uuid column</comment>
		<createIndex tableName="notification_alert" unique="true" indexName="notification_alert_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-notification_template" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="notification_template_uuid_index"/></not></preConditions>
		<comment>Creating unique index on notification_template.uuid column</comment>
		<createIndex tableName="notification_template" unique="true" indexName="notification_template_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-obs" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="obs_uuid_index"/></not></preConditions>
		<comment>Creating unique index on obs.uuid column</comment>
		<createIndex tableName="obs" unique="true" indexName="obs_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-order_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="order_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on order_type.uuid column</comment>
		<createIndex tableName="order_type" unique="true" indexName="order_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-orders" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="orders_uuid_index"/></not></preConditions>
		<comment>Creating unique index on orders.uuid column</comment>
		<createIndex tableName="orders" unique="true" indexName="orders_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_identifier" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_identifier_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_identifier.uuid column</comment>
		<createIndex tableName="patient_identifier" unique="true" indexName="patient_identifier_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_identifier_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_identifier_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_identifier_type.uuid column</comment>
		<createIndex tableName="patient_identifier_type" unique="true" indexName="patient_identifier_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_program_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_program.uuid column</comment>
		<createIndex tableName="patient_program" unique="true" indexName="patient_program_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-patient_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="patient_state_uuid_index"/></not></preConditions>
		<comment>Creating unique index on patient_state.uuid column</comment>
		<createIndex tableName="patient_state" unique="true" indexName="patient_state_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person.uuid column</comment>
		<createIndex tableName="person" unique="true" indexName="person_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_address" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_address_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_address.uuid column</comment>
		<createIndex tableName="person_address" unique="true" indexName="person_address_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_attribute" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_attribute_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_attribute.uuid column</comment>
		<createIndex tableName="person_attribute" unique="true" indexName="person_attribute_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_attribute_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_attribute_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_attribute_type.uuid column</comment>
		<createIndex tableName="person_attribute_type" unique="true" indexName="person_attribute_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-person_name" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="person_name_uuid_index"/></not></preConditions>
		<comment>Creating unique index on person_name.uuid column</comment>
		<createIndex tableName="person_name" unique="true" indexName="person_name_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-privilege" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="privilege_uuid_index"/></not></preConditions>
		<comment>Creating unique index on privilege.uuid column</comment>
		<createIndex tableName="privilege" unique="true" indexName="privilege_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program.uuid column</comment>
		<createIndex tableName="program" unique="true" indexName="program_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program_workflow" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_workflow_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program_workflow.uuid column</comment>
		<createIndex tableName="program_workflow" unique="true" indexName="program_workflow_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-program_workflow_state" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="program_workflow_state_uuid_index"/></not></preConditions>
		<comment>Creating unique index on program_workflow_state.uuid column</comment>
		<createIndex tableName="program_workflow_state" unique="true" indexName="program_workflow_state_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-relationship" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="relationship_uuid_index"/></not></preConditions>
		<comment>Creating unique index on relationship.uuid column</comment>
		<createIndex tableName="relationship" unique="true" indexName="relationship_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-relationship_type" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="relationship_type_uuid_index"/></not></preConditions>
		<comment>Creating unique index on relationship_type.uuid column</comment>
		<createIndex tableName="relationship_type" unique="true" indexName="relationship_type_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-report_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="report_object_uuid_index"/></not></preConditions>
		<comment>Creating unique index on report_object.uuid column</comment>
		<createIndex tableName="report_object" unique="true" indexName="report_object_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-report_schema_xml" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="report_schema_xml_uuid_index"/></not></preConditions>
		<comment>Creating unique index on report_schema_xml.uuid column</comment>
		<createIndex tableName="report_schema_xml" unique="true" indexName="report_schema_xml_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-role" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="role_uuid_index"/></not></preConditions>
		<comment>Creating unique index on role.uuid column</comment>
		<createIndex tableName="role" unique="true" indexName="role_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	<changeSet id="20090402-1519-serialized_object" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="serialized_object_uuid_index"/></not></preConditions>
		<comment>Creating unique index on serialized_object.uuid column</comment>
		<createIndex tableName="serialized_object" unique="true" indexName="serialized_object_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090414-0804" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="is_a" />
		</preConditions>
		<comment>Dropping foreign key on concept_set.concept_id table</comment>
		<dropForeignKeyConstraint baseTableName="concept_set" constraintName="is_a" />
	</changeSet>
	
	<changeSet id="20090414-0805" author="bwolfe">
		<comment>Dropping primary key on concept set table</comment>
		<dropPrimaryKey tableName="concept_set" />
	</changeSet>
	
	<changeSet id="20090414-0806" author="bwolfe">
		<comment>Adding new integer primary key to concept set table</comment>
		<addColumn tableName="concept_set">
			<column name="concept_set_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="concept_set_pk" 
							 unique="true" uniqueConstraintName="concept_set_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>
	
	<changeSet id="20090414-0807" author="bwolfe">
		<comment>Adding index and foreign key to concept_set.concept_id column</comment>
		<createIndex tableName="concept_set" indexName="idx_concept_set_concept">
			<column name="concept_id"/>
		</createIndex>
		<addForeignKeyConstraint baseTableName="concept_set" baseColumnNames="concept_id" constraintName="is_a" referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>
	
	<changeSet id="20090414-0808a" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="identifies_patient" />
		</preConditions>
		<comment>Dropping foreign key on patient_identifier.patient_id column</comment>
		<dropForeignKeyConstraint baseTableName="patient_identifier" constraintName="identifies_patient" />
	</changeSet>
	
	<changeSet id="20090414-0808b" author="bwolfe">
		<comment>Dropping non-integer primary key on patient identifier table before adding a new integer primary key</comment> 
		<dropPrimaryKey tableName="patient_identifier" />
	</changeSet>
	
	<changeSet id="20090414-0809" author="bwolfe">
		<comment>Adding new integer primary key to patient identifier table</comment>
		<addColumn tableName="patient_identifier">
			<column name="patient_identifier_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="patient_identifier_pk" 
							 unique="true" uniqueConstraintName="patient_identifier_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>

	<changeSet id="20090414-0810" author="bwolfe">
		<comment>Adding index and foreign key on patient_identifier.patient_id column</comment>
		<createIndex tableName="patient_identifier" indexName="idx_patient_identifier_patient">
			<column name="patient_id"/>
		</createIndex>
		<addForeignKeyConstraint baseTableName="patient_identifier" baseColumnNames="patient_id" constraintName="identifies_patient" referencedTableName="patient" referencedColumnNames="patient_id" />
	</changeSet>
	
	<changeSet id="20090414-0811a" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<foreignKeyConstraintExists foreignKeyName="word_for" />
		</preConditions>
		<comment>Dropping foreign key on concept_word.concept_id column</comment>
		<dropForeignKeyConstraint baseTableName="concept_word" constraintName="word_for" />
	</changeSet>
	
	<changeSet id="20090428-0811aa" author="bwolfe" failOnError="false">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Removing concept_word.concept_name_id foreign key so that primary key can be changed to concept_word_id</comment>
		<dropForeignKeyConstraint baseTableName="concept_word" constraintName="word_for_name" />
	</changeSet>
	
	<changeSet id="20090414-0811b" author="bwolfe" failOnError="false">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Dropping non-integer primary key on concept word table before adding new integer one</comment>
		<dropPrimaryKey tableName="concept_word" />
	</changeSet>
	
	<changeSet id="20090414-0812" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="concept_word" columnName="concept_word_id" /></not>
		</preConditions>
		<comment>Adding integer primary key to concept word table</comment>
		<addColumn tableName="concept_word">
			<column name="concept_word_id" type="int(11)" autoIncrement="true">
				<constraints nullable="false" primaryKey="true" primaryKeyName="concept_word_pk" 
							 unique="true" uniqueConstraintName="concept_word_id_unique" />
			</column>
		</addColumn>
		<modifySql dbms="mysql">
			<append value=" FIRST" />
		</modifySql>
	</changeSet>
	
	<changeSet id="20090414-0812b" author="bwolfe" failOnError="false">
		<comment>Re-adding foreign key for concept_word.concept_name_id</comment>
		<addForeignKeyConstraint baseTableName="concept_word" baseColumnNames="concept_name_id" constraintName="word_for_name" referencedTableName="concept_name" referencedColumnNames="concept_name_id"/>
	</changeSet>
	
	<changeSet id="20090428-0854" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="word_for"/>
			</not>
		</preConditions>
		<comment>Adding foreign key for concept_word.concept_id column</comment>
		<addForeignKeyConstraint baseTableName="concept_word" baseColumnNames="concept_id" constraintName="word_for" referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>
	
	<changeSet id="200905150821" author="bwolfe">
		<comment>Deleting duplicate concept word keys</comment>
		<sql>delete from concept_word
             where
               concept_word_id not in (
                              select 
                                concept_word_id
                              from (select
                                      min(concept_word_id) as concept_word_id
                                    from
                                      concept_word 
                                    group by
                                      concept_id, word, locale
                                   ) as tmp_concept_word_dupes
                              )
              <!-- complicated sql needed to get around deleting from a table and doing a select from it -->
		</sql>
	</changeSet>
	
	<changeSet id="200904271042" author="bwolfe">
		<comment>Remove the now unused synonym column</comment>
		<dropColumn tableName="concept_word" columnName="synonym"/>
	</changeSet>
	
	<changeSet id="200902142212" author="ewolodzko">
		<comment>
			Add a sortWeight field to PersonAttributeType
		</comment>
		<addColumn tableName="person_attribute_type">
			<column name="sort_weight" type="int" />
		</addColumn>
	</changeSet>
	
	<changeSet id="200902142213" author="ewolodzko">
		<comment>
			Add default sortWeights to all current PersonAttributeTypes
		</comment>
		<update tableName="person_attribute_type" >
			<!-- The weird (select * from person_attribute_type) is needed here instead of just (person_attribute_type) to avoid sql ERROR 1093 -->
			<column name="sort_weight" valueNumeric="((select count(*) from (select * from person_attribute_type) pat where pat.name &lt; person_attribute_type.name))" />
			<where>sort_weight is null</where>
		</update>
	</changeSet>
	
	<changeSet id="200906301606" author="bwolfe">
		<comment>
			Change person_attribute_type.sort_weight from an integer to a float
		</comment>
		<modifyColumn tableName="person_attribute_type" >
			<column name="sort_weight" type="double" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-1" author="bwolfe">
		<comment>Change obs.value_numeric from a double(22,0) to a double</comment>
		<modifyColumn tableName="obs"><column name="value_numeric" type="double" /></modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-2" author="bwolfe">
		<comment>Change concept_numeric columns from a double(22,0) type to a double</comment>
		<modifyColumn tableName="concept_numeric">
			<column name="hi_absolute" type="double" />
			<column name="hi_critical" type="double" />
			<column name="hi_normal" type="double" />
			<column name="low_normal" type="double" />
			<column name="low_critical" type="double" />
			<column name="low_absolute" type="double" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-3" author="bwolfe">
		<comment>Change concept_set.sort_weight from a double(22,0) to a double</comment>
		<modifyColumn tableName="concept_set"><column name="sort_weight" type="double" /></modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-4" author="bwolfe">
		<comment>Change concept_set_derived.sort_weight from a double(22,0) to a double</comment>
		<modifyColumn tableName="concept_set_derived"><column name="sort_weight" type="double" /></modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-5" author="bwolfe">
		<comment>Change drug table columns from a double(22,0) to a double</comment>
		<modifyColumn tableName="drug" >
			<column name="dose_strength" type="double" />
			<column name="maximum_daily_dose" type="double" />
			<column name="minimum_daily_dose" type="double" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200907161638-6" author="bwolfe">
		<comment>Change drug_order.dose from a double(22,0) to a double</comment>
		<modifyColumn tableName="drug_order">
			<column name="dose" type="double" />
			<column name="equivalent_daily_dose" type="double" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="20100128-1" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT COUNT(*) FROM role where role = 'System Developer'
			</sqlCheck>
		</preConditions>
		<comment>Adding 'System Developer' role again (see ticket #1499)</comment>
		<insert tableName="role">
			<column name="role" value="System Developer"/>
			<column name="description" value="Assigned to Administrators of OpenMRS. Gives additional access to change core aspects of the system."/>
			<column name="uuid" valueNumeric="name-of-uuid-function"/>
		</insert>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
		<modifySql><replace replace="name-of-uuid-function" with="current_timestamp * 99999999999999"/></modifySql>
	</changeSet>	
	
	<changeSet id="20100128-2" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="20090803-1" author="jkariuki" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Switching users back from 'Administrator' to 'System Developer' (see ticket #1499)</comment>
		<update tableName="user_role">
			<column name="role" value="System Developer"/>
			<where>role='Administrator'</where>
		</update>
	</changeSet>
	
	<changeSet id="20100128-3" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<changeSetExecuted id="20090803-1" author="jkariuki" changeLogFile="liquibase-update-to-latest.xml"/>
		</preConditions>
		<comment>Deleting 'Administrator' role (see ticket #1499)</comment>
		<delete tableName="role">
			<where>role='Administrator'</where>
		</delete>
	</changeSet>
	    
	<changeSet id="20090831-1039-38-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="scheduler_task_config" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to scheduler_task_config table</comment>
		<addColumn tableName="scheduler_task_config">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20090831-1040-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in scheduler_task_config table via built in uuid function.</comment>
		<update tableName="scheduler_task_config" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	
	<changeSet id="20090831-1041-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to all rows in scheduler_task_config table via a java class for non mysql/oracle/mssql databases.
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				scheduler_task_config
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				scheduler_task_config=task_config_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="20090831-1042-scheduler_task_config" author="bwolfe">
		<comment>
			Now that UUID generation is done for scheduler_task_config, set the uuid column to not "NOT NULL" 
		</comment>
		<addNotNullConstraint tableName="scheduler_task_config" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>
	
	<changeSet id="20090831-1043-scheduler_task_config" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><indexExists indexName="scheduler_task_config_uuid_index"/></not></preConditions>
		<comment>Creating unique index on scheduler_task_config.uuid column</comment>
		<createIndex tableName="scheduler_task_config" unique="true" indexName="scheduler_task_config_uuid_index" >
			<column name="uuid" />
		</createIndex>
	</changeSet>
	
	<changeSet id="20090907-1" author="Knoll_Frank">
		<comment>Rename the concept_source.date_voided column to date_retired</comment>
		<renameColumn tableName="concept_source" oldColumnName="date_voided" newColumnName="date_retired" columnDataType="datetime" />
	</changeSet>
	<changeSet id="20090907-2" author="Knoll_Frank">
		<comment>Rename the concept_source.voided_by column to retired_by</comment>	
		<dropForeignKeyConstraint baseTableName="concept_source" constraintName="user_who_voided_concept_source" />
		<renameColumn tableName="concept_source" oldColumnName="voided_by" newColumnName="retired_by" columnDataType="int" />
		<addForeignKeyConstraint baseColumnNames="retired_by" baseTableName="concept_source" constraintName="user_who_retired_concept_source" deferrable="false" initiallyDeferred="false" referencedColumnNames="user_id" referencedTableName="users" />
	</changeSet>
	<changeSet id="20090907-3" author="Knoll_Frank">
		<comment>Rename the concept_source.voided column to retired</comment>
		<renameColumn tableName="concept_source" oldColumnName="voided" newColumnName="retired" columnDataType="smallint" />
	</changeSet>
	<changeSet id="20090907-4" author="Knoll_Frank">
		<comment>Rename the concept_source.void_reason column to retire_reason</comment>
		<renameColumn tableName="concept_source" oldColumnName="void_reason" newColumnName="retire_reason" columnDataType="varchar(255)" />
	</changeSet>
	
	<changeSet id="200908291938-1" author="dthomas">
		<comment>set hl7_code in ConceptSource to nullable column</comment>
		<modifyColumn tableName="concept_source">
			<column name="hl7_code" type="varchar(50)">
				<constraints nullable="true" />
			</column>
		</modifyColumn>
	</changeSet>
	
	<changeSet id="200908291938-2a" author="dthomas">
		<comment>set retired in ConceptSource to tinyint(1) not null</comment>
		<modifyColumn tableName="concept_source">
			<column name="retired" type="tinyint(1)">
				<constraints nullable="false" />
			</column>
		</modifyColumn>
	</changeSet>
	
    <changeSet id="200909281005-1" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="logic_rule_token"/>
            </not>
        </preConditions>
        <comment>Create logic token table to store all registered token</comment>
        <createTable tableName="logic_rule_token">
            <column name="logic_rule_token_id" type="int">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column defaultValueDate="0002-11-30T00:00:00.0" name="date_created" type="datetime">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="datetime"/>
            <column name="token" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
            <column name="class_name" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="varchar(512)" />
        </createTable>
    </changeSet>
    
    <changeSet id="200909281005-2" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="logic_rule_token_tag"/>
            </not>
        </preConditions>
        <comment>Create logic token tag table to store all tag associated with a token</comment>
        <createTable tableName="logic_rule_token_tag">
            <column name="logic_rule_token_id" type="int">
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="tag" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet id="200909281005-3" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="token_tag"/>
            </not>
        </preConditions>
        <comment>Adding foreign key for primary key of logic_rule_token_tag</comment>
        <addForeignKeyConstraint baseTableName="logic_rule_token_tag" baseColumnNames="logic_rule_token_id" constraintName="token_tag"
                                 referencedTableName="logic_rule_token" referencedColumnNames="logic_rule_token_id" />
    </changeSet>
    
    <changeSet id="200909281005-4a" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="token_tag_creator"/>
        </preConditions>
        <comment>Removing bad foreign key for logic_rule_token.creator</comment>
        <dropForeignKeyConstraint baseTableName="logic_rule_token" constraintName="token_tag_creator" />
    </changeSet>
    
    <changeSet id="200909281005-4aa" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <foreignKeyConstraintExists foreignKeyName="token_creator"/>
        </preConditions>
        <comment>Removing bad foreign key for logic_rule_token.creator</comment>
        <dropForeignKeyConstraint baseTableName="logic_rule_token" constraintName="token_creator" />
    </changeSet>
    
    <changeSet id="200909281005-4b" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="token_creator_fk"/>
            </not>
        </preConditions>
        <comment>Adding correct foreign key for logic_rule_token.creator</comment>
        <addForeignKeyConstraint baseTableName="logic_rule_token" baseColumnNames="creator" constraintName="token_creator_fk"
                                 referencedTableName="users" referencedColumnNames="user_id" />
    </changeSet>
    
    <changeSet id="200909281005-5a" author="nribeka">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="token_changed_by"/>
            </not>
        </preConditions>
        <comment>Adding foreign key for logic_rule_token.changed_by</comment>
        <addForeignKeyConstraint baseTableName="logic_rule_token" baseColumnNames="changed_by" constraintName="token_changed_by"
                                 referencedTableName="users" referencedColumnNames="user_id" />
    </changeSet>
   
    <changeSet id="200910271049-1" author="bwolfe">
		<comment>Setting core field types to have standard UUIDs</comment>
		<update tableName="field_type"><column name="uuid" value="8d5e7d7c-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '1' and name = 'Concept'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e8196-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '2' and name = 'Database element'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e836c-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '3' and name = 'Set of Concepts'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e852e-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '4' and name = 'Miscellaneous Set'</where></update>
		<update tableName="field_type"><column name="uuid" value="8d5e86fa-c2cc-11de-8d13-0010c6dffd0f"/><where>field_type_id= '5' and name = 'Section'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-2" author="bwolfe">
		<comment>Setting core person attribute types to have standard UUIDs</comment>
		<update tableName="person_attribute_type"><column name="uuid" value="8d8718c2-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '2' and name = 'Birthplace'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871afc-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '3' and name = 'Citizenship'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871f2a-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '5' and name = 'Civil Status'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d87236c-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '7' and name = 'Health Center'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d872150-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '6' and name = 'Health District'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871d18-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '4' and name = 'Mother\'s Name'</where></update>
		<update tableName="person_attribute_type"><column name="uuid" value="8d871386-c2cc-11de-8d13-0010c6dffd0f"/><where>person_attribute_type_id= '1' and name = 'Race'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-3" author="bwolfe">
		<comment>Setting core encounter types to have standard UUIDs</comment>
		<update tableName="encounter_type"><column name="uuid" value="8d5b27bc-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '1' and name = 'ADULTINITIAL'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b2be0-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '2' and name = 'ADULTRETURN'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b2dde-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '3' and name = 'PEDSINITIAL'</where></update>
		<update tableName="encounter_type"><column name="uuid" value="8d5b3108-c2cc-11de-8d13-0010c6dffd0f"/><where>encounter_type_id= '4' and name = 'PEDSRETURN'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-4" author="bwolfe">
		<comment>Setting core concept datatypes to have standard UUIDs</comment>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4488-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '1' and name = 'Numeric'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a48b6-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '2' and name = 'Coded'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4ab4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '3' and name = 'Text'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4c94-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '4' and name = 'N/A'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a4e74-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '5' and name = 'Document'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a505e-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '6' and name = 'Date'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a591e-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '7' and name = 'Time'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5af4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '8' and name = 'Datetime'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5cca-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '10' and name = 'Boolean'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a5e96-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '11' and name = 'Rule'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a606c-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '12' and name = 'Structured Numeric'</where></update>
		<update tableName="concept_datatype"><column name="uuid" value="8d4a6242-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_datatype_id= '13' and name = 'Complex'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-5" author="bwolfe">
		<comment>Setting core relationship types to have standard UUIDs</comment>
		<update tableName="relationship_type"><column name="uuid" value="8d919b58-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '1' and a_is_to_b = 'Doctor' and b_is_to_a = 'Patient'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a01c-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '2' and a_is_to_b = 'Sibling' and b_is_to_a = 'Sibling'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a210-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '3' and a_is_to_b = 'Parent' and b_is_to_a = 'Child'</where></update>
		<update tableName="relationship_type"><column name="uuid" value="8d91a3dc-c2cc-11de-8d13-0010c6dffd0f"/><where> relationship_type_id = '4' and a_is_to_b = 'Aunt/Uncle' and b_is_to_a = 'Niece/Nephew'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-6" author="bwolfe">
		<comment>Setting core concept classes to have standard UUIDs</comment>
		<update tableName="concept_class"><column name="uuid" value="8d4907b2-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '1' and name = 'Test'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d490bf4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '2' and name = 'Procedure'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d490dfc-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '3' and name = 'Drug'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d4918b0-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '4' and name = 'Diagnosis'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491a9a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '5' and name = 'Finding'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491c7a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '6' and name = 'Anatomy'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d491e50-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '7' and name = 'Question'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492026-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '8' and name = 'LabSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d4923b4-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '9' and name = 'MedSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492594-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '10' and name = 'ConvSet'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492774-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '11' and name = 'Misc'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492954-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '12' and name = 'Symptom'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492b2a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '13' and name = 'Symptom/Finding'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492d0a-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '14' and name = 'Specimen'</where></update>
		<update tableName="concept_class"><column name="uuid" value="8d492ee0-c2cc-11de-8d13-0010c6dffd0f"/><where>concept_class_id= '15' and name = 'Misc Order'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-7" author="bwolfe">
		<comment>Setting core patient identifier types to have standard UUIDs</comment>
		<update tableName="patient_identifier_type"><column name="uuid" value="8d79403a-c2cc-11de-8d13-0010c6dffd0f"/><where>patient_identifier_type_id= '2' and name = 'Old Identification Number'</where></update>
		<update tableName="patient_identifier_type"><column name="uuid" value="8d793bee-c2cc-11de-8d13-0010c6dffd0f"/><where>patient_identifier_type_id= '1' and name = 'OpenMRS Identification Number'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-8" author="bwolfe">
		<comment>Setting core location to have standard UUIDs</comment>
		<update tableName="location"><column name="uuid" value="8d6c993e-c2cc-11de-8d13-0010c6dffd0f"/><where>location_id= '1' and name = 'Unknown Location'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-9" author="bwolfe">
		<comment>Setting core hl7 source to have standard UUIDs</comment>
		<update tableName="hl7_source"><column name="uuid" value="8d6b8bb6-c2cc-11de-8d13-0010c6dffd0f"/><where>hl7_source_id= '1' and name = 'LOCAL'</where></update>
	</changeSet>
	
	<changeSet id="200910271049-10" author="bwolfe">
		<comment>Setting core roles to have standard UUIDs</comment>
		<update tableName="role"><column name="uuid" value="774b2af3-6437-4e5a-a310-547554c7c65c"/><where> role = 'Anonymous'</where></update>
		<update tableName="role"><column name="uuid" value="f7fd42ef-880e-40c5-972d-e4ae7c990de2"/><where> role = 'Authenticated'</where></update>
		<update tableName="role"><column name="uuid" value="8d94f280-c2cc-11de-8d13-0010c6dffd0f"/><where> role = 'Provider'</where></update>
		<update tableName="role"><column name="uuid" value="8d94f852-c2cc-11de-8d13-0010c6dffd0f"/><where> role = 'System Developer'</where></update>
	</changeSet>
	
	<changeSet id="200912071501-1" author="arthurs"> 
		<comment>Change name for patient.searchMaxResults global property to person.searchMaxResults</comment> 
		<update tableName="global_property"><column name="property" value="person.searchMaxResults"/><where> property = 'patient.searchMaxResults'</where></update> 
	</changeSet>

	<changeSet id="200912141552" author="madanmohan">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="encounter" columnName="changed_by" />
			</not>
		</preConditions>
		<comment>
			Add changed_by column to encounter table
		</comment>
		<addColumn tableName="encounter">
			<column name="changed_by" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="encounter_changed_by"
			baseTableName="encounter" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
		
	<changeSet id="200912141553" author="madanmohan">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="encounter" columnName="date_changed" />
			</not>
		</preConditions>
		<comment>
			Add date_changed column to encounter table
		</comment>
		<addColumn tableName="encounter">
			<column name="date_changed" type="datetime" />
		</addColumn>
	</changeSet>	

	<changeSet id="200912031842" author="djazayeri">
		<!-- This is safe to re-run, and the pre-condition is hard to write, so I'm not writing one -->
		<comment>Changing encounter.provider_id to reference person instead of users</comment>
		<dropForeignKeyConstraint baseTableName="encounter" constraintName="encounter_provider"/>
		<addForeignKeyConstraint baseTableName="encounter" baseColumnNames="provider_id" constraintName="encounter_provider"
                                 referencedTableName="person" referencedColumnNames="person_id"/>
	</changeSet>
	
	<changeSet id="200912031846-1" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="users" columnName="person_id"/>
			</not>
		</preConditions>
		<comment>Adding person_id column to users table</comment>
		<dropForeignKeyConstraint baseTableName="users" constraintName="person_id_for_user"/>
		<addColumn tableName="users">
			<column name="person_id" type="int"/>
		</addColumn>
		<update tableName="users">
			<column name="person_id" valueNumeric="user_id"/>
		</update>
	</changeSet>

	<changeSet id="200912031846-2" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<sqlCheck expectedResult="0">
					select count(*) from users where person_id is null
				</sqlCheck>
			</not>
		</preConditions>
		<comment>Populating users.person_id</comment>
		<update tableName="users">
			<column name="person_id" valueNumeric="user_id"/>
			<where>person_id is null</where>
		</update>
		<addNotNullConstraint tableName="users" columnName="person_id" columnDataType="int"/>
	</changeSet>

	<changeSet id="200912031846-3" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="person_id_for_user"/>
			</not>
		</preConditions>
		<comment>Restoring foreign key constraint on users.person_id</comment>
		<addForeignKeyConstraint constraintName="person_id_for_user"
								 baseTableName="users" baseColumnNames="person_id"
								 referencedTableName="person" referencedColumnNames="person_id"/>
		<addAutoIncrement tableName="users" columnName="user_id" columnDataType="int"/>
	</changeSet>
	
	<changeSet id="200912091819" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="users" columnName="retired"/>
			</not>
		</preConditions>
		<comment>Adding retired metadata columns to users table</comment>
		<addColumn tableName="users">
			<column name="retired" type="tinyint" defaultValueNumeric="0">
				<constraints nullable="false"/>
			</column>
			<column name="retired_by" type="int(11)"/>
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="user_who_retired_this_user"
			baseTableName="users" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id"
		/>
	</changeSet>
	
	<changeSet id="200912091820" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<and>
				<columnExists tableName="users" columnName="retired"/>
				<columnExists tableName="users" columnName="voided"/>
			</and>
		</preConditions>
		<comment>Migrating voided metadata to retired metadata for users table</comment>
		<update tableName="users">
			<column name="retired" valueNumeric="voided"/>
			<column name="retired_by" valueNumeric="voided_by"/>
			<column name="date_retired" valueNumeric="date_voided"/>
			<column name="retire_reason" valueNumeric="void_reason"/>
		</update>
	</changeSet>
	
	<changeSet id="200912091821" author="djazayeri">
		<preConditions onFail="HALT">
			<and>
				<columnExists tableName="users" columnName="retired"/>
				<columnExists tableName="users" columnName="voided"/>
				<sqlCheck expectedResult="0">
					select count(*) from users where voided != retired
				</sqlCheck>
			</and>
		</preConditions>
		<comment>Dropping voided metadata columns from users table</comment>
		<dropForeignKeyConstraint baseTableName="users" constraintName="user_who_voided_user"/>
		<dropColumn tableName="users" columnName="voided"/>
		<dropColumn tableName="users" columnName="voided_by"/>
		<dropColumn tableName="users" columnName="date_voided"/>
		<dropColumn tableName="users" columnName="void_reason"/>
	</changeSet>
	
	<changeSet id="200912140038" author="djazayeri">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="users" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to users table</comment>
		<addColumn tableName="users">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>

	<changeSet id="200912140039" author="djazayeri">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in users table via built in uuid function.</comment>
		<update tableName="users" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>
	
	<changeSet id="20100415-forgotten-from-before" author="djazayeri">
		<comment>Adding not null constraint to users.uuid</comment>
		<addNotNullConstraint tableName="users" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>

	<changeSet id="200912140040" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to users table via a java class. (This will take a long time on large databases)
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				users
			</param>
			<param name="columnName" value="uuid"/>
			<param name="idExceptions">
				users_id=user_id
			</param>
		</customChange>
	</changeSet>
	
	<changeSet id="200912151032" author="n.nehete">
		<preConditions onFail="HALT">
			<sqlCheck expectedResult="All encounters have a non-null encounter type.">
				<![CDATA[
					SELECT case when count(*) > 0 
							then 'There are rows in the encounter table with an empty encounter type.  Encounter type is a required field and must be populated.  These encounters need to be fixed manually by setting an appropriate encounter type.' 
							else 'All encounters have a non-null encounter type.' end 
					FROM encounter where encounter_type is null;
				]]>
			</sqlCheck>
		</preConditions>	
		<comment>Encounter Type should not be null when saving an Encounter</comment>
		<addNotNullConstraint tableName="encounter" columnName="encounter_type" columnDataType="int" />
	</changeSet>	
	
	<changeSet id="201001072007" author="upul">
		<preConditions onFail="MARK_RAN">
			<not><columnExists tableName="scheduler_task_config" columnName="last_execution_time"/></not>
		</preConditions>
		<comment>
			Add last execution time column to scheduler_task_config table
		</comment>		
		<addColumn tableName="scheduler_task_config">
			<column name="last_execution_time" type="DATETIME">
				<constraints nullable="true"/>
			</column>
		</addColumn>
	</changeSet>    	
	
    <changeSet id="20091001-1023" author="rcrichton">
    	<preConditions onFail="MARK_RAN">
    		<not>
    			<columnExists tableName="relationship_type" columnName="retired"/>
    		</not>
    	</preConditions>
		<comment>add retired column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retired" type="tinyint(1)" defaultValue="0">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1024" author="rcrichton">
		<preConditions onFail="MARK_RAN">
    		<not>
    			<columnExists tableName="relationship_type" columnName="retired_by"/>
    		</not>
    	</preConditions>
		<comment>add retired_by column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retired_by" type="int"/>
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1025" author="rcrichton">
		<preConditions onFail="MARK_RAN">
			<not><foreignKeyConstraintExists foreignKeyName="user_who_retired_relationship_type"/></not>
		</preConditions>
		<comment>
			Create the foreign key from the relationship.retired_by to users.user_id.
		</comment>
		<addForeignKeyConstraint constraintName="user_who_retired_relationship_type"
			baseTableName="relationship_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
    </changeSet>
	
	<changeSet id="20091001-1026" author="rcrichton">
		<preConditions onFail="MARK_RAN">
    		<not>
    			<columnExists tableName="relationship_type" columnName="date_retired"/>
    		</not>
    	</preConditions>
		<comment>add date_retired column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="date_retired" type="datetime" />
		</addColumn>
	</changeSet>
	
	<changeSet id="20091001-1027" author="rcrichton">
		<preConditions onFail="MARK_RAN">
    		<not>
    			<columnExists tableName="relationship_type" columnName="retire_reason"/>
    		</not>
    	</preConditions>
		<comment>add retire_reason column to relationship_type table</comment>
		<addColumn tableName="relationship_type">
			<column name="retire_reason" type="varchar(255)" />
		</addColumn>
	</changeSet>

	<changeSet id="20091215-0208" author="sunbiz">
		<comment>
			Prune concepts rows orphaned in concept_numeric tables
		</comment>
		<sql>
			<![CDATA[
				DELETE concept_numeric FROM concept_numeric
				INNER JOIN concept ON concept.concept_id = concept_numeric.concept_id
				AND concept.datatype_id NOT IN (1,12)
			]]>
		</sql>
	</changeSet>

	<changeSet id="20091215-0209" author="jmiranda">
		<comment>
			Prune concepts rows orphaned in concept_complex tables
		</comment>
		<sql>
			<![CDATA[
				DELETE concept_complex FROM concept_complex
				INNER JOIN concept ON concept.concept_id = concept_complex.concept_id 
				AND concept.datatype_id NOT IN (5, 13)
			]]>
		</sql>
	</changeSet>

	<changeSet id="20091215-0210" author="jmiranda">
		<comment>
			Prune concepts rows orphaned in concept_derived tables
		</comment>
		<sql>
			<![CDATA[			
				DELETE concept_derived FROM concept_derived
				INNER JOIN concept ON concept.concept_id = concept_derived.concept_id 
				AND concept.datatype_id <> 11	
			]]>
		</sql>
	</changeSet>
	
	<changeSet id="20100306-095513" author="thilini.hg">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="notification_alert" columnName="user_id"/>
		</preConditions>
		<comment>Dropping unused user_id column from notification alert table</comment>
		<dropForeignKeyConstraint baseTableName="notification_alert" constraintName="alert_assigned_to_user"/>
		<dropColumn tableName="notification_alert" columnName="user_id"/>
	</changeSet>
	
	<changeSet id="20100322-0908" author="syhaas">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="concept_answer" columnName="sort_weight"/>
			</not>
		</preConditions>
		<comment>Adding sort_weight column to concept_answers table and initially sets the sort_weight to the concept_answer_id</comment>
		<addColumn tableName="concept_answer">
			<column name="sort_weight" type="double"></column>
		</addColumn>
		<update tableName="concept_answer">
			<column name="sort_weight" valueNumeric="concept_answer_id"/>
		</update>
	</changeSet>
	
	<changeSet id="20100412-2217" author="bwolfe">
		<preConditions onFail="MARK_RAN"><not><columnExists tableName="notification_alert_recipient" columnName="uuid"/></not></preConditions>
		<comment>Adding "uuid" column to notification_alert_recipient table</comment>
		<addColumn tableName="notification_alert_recipient">
			<column name="uuid" type="char(38)" />
		</addColumn>
	</changeSet>

	<changeSet id="20100412-2218" author="bwolfe">
		<preConditions onFail="MARK_RAN"><or><dbms type="mysql" /><dbms type="oracle" /><dbms type="mssql" /></or></preConditions>
		<comment>Generating UUIDs for all rows in notification_alert_recipient table via built in uuid function.</comment>
		<update tableName="notification_alert_recipient" >
			<column name="uuid" valueNumeric="name-of-uuid-function" />
			<where>uuid is null</where>
		</update>
		<modifySql dbms="mysql"><replace replace="name-of-uuid-function" with="UUID()"/></modifySql>
		<modifySql dbms="oracle"><replace replace="name-of-uuid-function" with="SYS_GUID()"/></modifySql>
		<modifySql dbms="mssql"><replace replace="name-of-uuid-function" with="NEWSEQUENTIALID()"/></modifySql>
	</changeSet>

	<changeSet id="20100412-2219" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<not>
				<or>
					<dbms type="mysql" />
					<dbms type="oracle" />
					<dbms type="mssql" />
				</or>
			</not>
		</preConditions>
		<comment>
			Adding UUIDs to notification_alert_recipient table via a java class (if needed).
		</comment>
		<customChange class="org.openmrs.util.databasechange.GenerateUuid">
			<param name="tableNames">
				notification_alert_recipient
			</param>
			<param name="columnName" value="uuid"/>
		</customChange>
	</changeSet>
	
	<changeSet id="20100412-2220" author="bwolfe">
		<comment>
			Now that UUID generation is done, set the notification_alert_recipient.uuid column to not "NOT NULL" 
		</comment>
		<addNotNullConstraint tableName="notification_alert_recipient" columnName="uuid" columnDataType="char(38)"/>
	</changeSet>
	
	<changeSet id="20100413-1509" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<columnExists tableName="location_tag" columnName="tag"/>
		</preConditions>
		<comment>
			Change location_tag.tag to location_tag.name
		</comment>
		<renameColumn tableName="location_tag"
   			 oldColumnName="tag" newColumnName="name" columnDataType="varchar(50)"/>
	</changeSet>
	
	<changeSet id="20100427-1334" author="bwolfe">
		<preConditions onFail="MARK_RAN">
			<dbms type="mysql" />
		</preConditions>
		<comment>
			Changing the datatype of global_property.property for mysql databases
		</comment>
		<modifyColumn tableName="global_property">
			<column name="property" type="varbinary(255)" />
		</modifyColumn>
	</changeSet>
	
	<changeSet id="20100423-1402" author="slorenz">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="encounter_datetime_idx"/>
			</not>
		</preConditions>
		<comment>Add an index to the encounter.encounter_datetime column to speed up statistical
			analysis.</comment>
		<createIndex tableName="encounter" indexName="encounter_datetime_idx">
			<column name="encounter_datetime"/>
		</createIndex>
	</changeSet>
	
	<changeSet id="20100423-1406" author="slorenz">
		<preConditions onFail="MARK_RAN">
			<not>
				<indexExists indexName="obs_datetime_idx"/>
			</not>
		</preConditions>
		<comment>Add an index to the obs.obs_datetime column to speed up statistical analysis.</comment>
		<createIndex tableName="obs" indexName="obs_datetime_idx">
			<column name="obs_datetime"/>
		</createIndex>
	</changeSet>
	
	<changeSet id="20100426-1947" author="syhaas">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				<![CDATA[
				SELECT count(*) FROM users WHERE system_id = 'daemon'
				]]>
			</sqlCheck>
		</preConditions>
		<comment>Adding daemon user to users table</comment>
		<insert tableName="users">
			<column name="system_id" value="daemon"/>
			<column name="username" value="daemon"/>
			<column name="creator" valueNumeric="1"/>
			<column name="date_created" valueDate="2010-04-26T13:25:00"/>
			<column name="retired" valueNumeric="0"/>
			<column name="uuid" value="A4F30A1B-5EB9-11DF-A648-37A07F9C90FB"/>
		</insert>
	</changeSet>
	
	<changeSet id="20100513-1947" author="syhaas">
		<comment>Removing scheduler.username and scheduler.password global properties</comment>
		<delete tableName="global_property">
			<where>property = 'scheduler.username'</where>
		</delete>
		<delete tableName="global_property">
			<where>property = 'scheduler.password'</where>
		</delete>
	</changeSet>

	<changeSet id="20100512-1400" author="djazayeri">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				select count(*) from order_type where order_type_id = 2
			</sqlCheck>
		</preConditions>
		<comment>Create core order_type for drug orders</comment>
		<insert tableName="order_type">
			<column name="order_type_id" valueNumeric="2" />
			<column name="name" value="Drug Order" />
			<column name="description" value="An order for a medication to be given to the patient" />
			<column name="creator" valueNumeric="1" />
			<column name="date_created" valueDate="2010-05-12" />
			<column name="retired" valueNumeric="0" />
			<column name="date_retired" />
			<column name="retire_reason" />
			<column name="uuid" value="131168f4-15f5-102d-96e4-000c29c2a5d7" />
		</insert>
	</changeSet>
	
	<changeSet id="20100517-1545" author="wyclif and djazayeri">
		<comment>Switch boolean concepts/observations to be stored as coded</comment>
		<customChange class="org.openmrs.util.databasechange.BooleanConceptChangeSet"/>				
	</changeSet>
	
	<changeSet id="20100526-1025" author="Harsha.cse">
		<comment>
			Drop Not-Null constraint from location column in Encounter and Obs table
		</comment>
		<dropNotNullConstraint tableName="encounter" columnName="location_id" columnDataType="int"/>
		<dropNotNullConstraint tableName="obs" columnName="location_id" columnDataType="int"/>
    </changeSet>
    
    <changeSet id="20100604-0933a" author="wyclif">
    	<preConditions onFail="MARK_RAN">
    		<columnExists columnName="message_state" tableName="hl7_in_archive" />
    	</preConditions>
    	<comment>
    		Changing the default value to 2 for 'message_state' column in 'hl7_in_archive' table
    	</comment>    	
    	<addDefaultValue columnName="message_state" tableName="hl7_in_archive" defaultValue="2"/>
    </changeSet>
    
    <changeSet id="20100604-0933b" author="wyclif">
    	<preConditions onFail="MARK_RAN">
    		<columnExists columnName="message_state" tableName="hl7_in_archive" />    		
    	</preConditions>
		<comment>Converting 0 and 1 to 2 for 'message_state' column in 'hl7_in_archive' table</comment>
		<update tableName="hl7_in_archive">
			<column name="message_state" value="2"/>
			<where>message_state IN (0,1)</where>
		</update>
	</changeSet>
	
	<changeSet id="20100323-192043" author="ricardosbarbosa">
		<comment>
			Removing the duplicate privilege 'Add Concept Proposal' in favor of 'Add Concept Proposals'
		</comment>
		<update tableName="role_privilege">
			<column name="privilege">Add Concept Proposals</column>
			<where>privilege = 'Add Concept Proposal' and not exists (select * from (select role, privilege from role_privilege) rp2 where rp2.role = role and rp2.privilege = 'Add Concept Proposals')</where>
		</update>
		<delete tableName="role_privilege"><where>privilege='Add Concept Proposal'</where></delete>
		<delete tableName="privilege"><where>privilege='Add Concept Proposal'</where></delete>
	</changeSet>
		
	<changeSet id="20100330-190413" author="ricardosbarbosa">
		<comment>
			Removing the duplicate privilege 'Edit Concept Proposal' in favor of 'Edit Concept Proposals'
		</comment>		
		<update tableName="role_privilege">
			<column name="privilege">Edit Concept Proposals</column>
			<where>privilege = 'Edit Concept Proposal' and not exists (select * from (select role, privilege from role_privilege) rp2 where rp2.role = role and rp2.privilege = 'Edit Concept Proposals')</where>
		</update>
		<delete tableName="role_privilege"><where>privilege='Edit Concept Proposal'</where></delete>
		<delete tableName="privilege"><where>privilege='Edit Concept Proposal'</where></delete>
	</changeSet>
	
</databaseChangeLog>